---
layout: post
title: Vue3与React和Svelte的区别
date: 2020-09-16 10:52:09
tags:
---


vue和react是前端开发中最流行的两种框架，它们在运行时进行工作，svelte利用编译优化思想，在编译过程中将顶层变量变更为响应式。


**Vue3**目前已经在rc阶段，和之前（vue2）一样，但是在代码组织结构与逻辑复用上有很大的改变。在vue2阶段，实现逻辑服用基本上靠mixin，但是mixin无法预知内部状态，会造成代码混乱，难以维护。

Vue3为了解决上述难题推出[Composition API](https://v3.vuejs.org/guide/composition-api-introduction.html#why-composition-api)。

> Creating Vue components allows us to extract repeatable parts of the interface coupled with its functionality into reusable pieces of code. This alone can get our application pretty far in terms of maintainability and flexibility. However, our collective experience has proved that this alone might not be enough, especially when your application is getting really big – think several hundreds of components. When dealing with such large applications, sharing and reusing code becomes especially important.

Composition API是为了构建大型可复用组件，在符合代码书写的前提下完成了逻辑复用。更多关于Composition API请参阅[指南](https://v3.vuejs.org/guide/composition-api-introduction.html)。这里要注意，Composition API中有一个很关键的概念`setup`，所有Composition API都编写在`setup`中，它在声明周期中位于`created`之前，所以在使用生命周期函数时请不要使用`beforeCreate`和`created`，更多请参与[指南](https://v3.vuejs.org/guide/composition-api-lifecycle-hooks.html)。请不要在`setup`中使用`this`，this不是当前实例的引用，而是`undefined`，所以尽量不要和其它`Options API`一起使用。

### Vue3中的Composition API和React的Hooks有什么区别呢？

**Vue3**中的Composition API在setup中编写，这个函数只会执行一次，而React在某些情况下会调用多次（比如定时请求），具体如下：

+ 一般来说更符合惯用的 JavaScript 代码的直觉；
+ 不需要顾虑调用顺序，也可以用在条件语句中；
+ 不会在每次渲染时重复执行，以降低垃圾回收的压力；
+ 不存在内联处理函数导致子组件永远更新的问题，也不需要 useCallback；
+ 不存在忘记记录依赖的问题，也不需要“useEffect”和“useMemo”并传入依赖数组以捕获过时的变量。Vue 的自动依赖跟踪可以确保侦听器和计算值总是准确无误。

注：上述信息来源于[Vue 组合式 API](https://composition-api.vuejs.org/zh/)

### Vue3中的Composition API和Svelte有什么区别呢？

Svelte与React、Vue、Ag不同，他利用编译的思想进行代码组织编写。它也没有使用虚拟DOM差异技术，而是通过封装过的代码进行DOM更新，以下是Svelte的输出。

> Svelte is a component framework — like React or Vue — but with an important difference. Traditional frameworks allow you to write declarative state-driven code, but there's a penalty: the browser must do extra work to convert those declarative structures into DOM operations, using techniques like  that eat into your frame budget and tax the garbage collector.

> Instead, Svelte runs at build time, converting your components into highly efficient imperative code that surgically updates the DOM. As a result, you're able to write ambitious applications with excellent performance characteristics.

```html
<script>
	let name = 'world';
</script>

<h1>Hello {name}!</h1>
```
以上代码经过Svelte的编译之后会输出如下代码：
```javascript
/* App.svelte generated by Svelte v3.25.1 */
import {
	SvelteComponent,
	detach,
	element,
	init,
	insert,
	noop,
	safe_not_equal
} from "svelte/internal";

function create_fragment(ctx) {
	let h1;

	return {
		c() {
			h1 = element("h1");
			h1.textContent = `Hello ${name}!`;
		},
		m(target, anchor) {
			insert(target, h1, anchor);
		},
		p: noop,
		i: noop,
		o: noop,
		d(detaching) {
			if (detaching) detach(h1);
		}
	};
}

let name = "world";

class App extends SvelteComponent {
	constructor(options) {
		super();
		init(this, options, null, create_fragment, safe_not_equal, {});
	}
}

export default App;
```

在**Vue3**中，不需要借助编译器（webpack、rollup）的帮助，可以直接运行在浏览器侧或服务器（ssr）侧。

```html
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script type="module">
    import { createApp } from 'https://unpkg.com/vue@3.0.0-rc.10/dist/vue.esm-browser.js'

    const App = createApp({
      template: `<button>change A value</button>`,
    })

    App.mount('#root')
  </script>
</html>
```

从以上代码可以看出来，它们分别有自己的优劣势：

+ Svelte 的代码看起来更简洁，但是已经不属于标准 JavaScript。
+ Svelte 编译更快，但是不适合构建大型应用，因为它的社区目前来说没有Vue、React庞大。
+ Svelte 响应只有顶层变量，函数内部声明的变量并不具有响应性。
+ Svelte 很难集成TypeScript，难以利用社区优势构建应用。

### 最终结论

Vue3的Composition API是Vue发展过程的产物，是为了解决构建大型应用逻辑代码复用问题。相比Vue2配置型API，我更倾向于Vue3的Composition API。

Svelte的思想是非常先进的，基于编译优化的思想在没有diff情况下性能并没有很大的区别。

参考链接：

+ [https://svelte.dev/](https://svelte.dev/)
+ [https://v3.vuejs.org/](https://v3.vuejs.org/)
+ [https://composition-api.vuejs.org/](https://composition-api.vuejs.org/)
